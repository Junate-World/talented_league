{% extends "base.html" %}

{% block title %}Fan Base - {{ config['SITE_NAME'] or 'Football League' }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="card shadow mb-4">
                <div class="card-body text-center">
                    <h1 class="mb-3">üì£ Fan Base</h1>
                    <p class="lead text-muted">Share your thoughts, support your team, and connect with fellow fans!</p>
                </div>
            </div>

            <!-- Comment Form -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üí¨ Leave a Comment</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('fan.add_comment') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Name *</label>
                                    <input type="text" class="form-control" id="name" name="name" 
                                           required maxlength="100" placeholder="Enter your name">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nickname" class="form-label">Nickname (Optional)</label>
                                    <input type="text" class="form-control" id="nickname" name="nickname" 
                                           maxlength="100" placeholder="Your fan nickname">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="comment" class="form-label">Comment *</label>
                            <textarea class="form-control" id="comment" name="comment" rows="4" 
                                      required minlength="10" maxlength="1000" 
                                      placeholder="Share your thoughts about the league, your team, or recent matches..."></textarea>
                            <small class="text-muted">Minimum 10 characters, maximum 1000 characters</small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Post Comment
                        </button>
                    </form>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">üí≠ Fan Comments</h5>
                </div>
                <div class="card-body">
                    {% if comments.items %}
                        {% for comment in comments.items %}
                        <div class="comment-item border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-1">
                                        {{ comment.display_name }}
                                        {% if comment.nickname %}
                                        <small class="text-muted">({{ comment.name }})</small>
                                        {% endif %}
                                    </h6>
                                    <small class="text-muted">{{ comment.formatted_date }}</small>
                                </div>
                            </div>
                            <p class="mb-0">{{ comment.comment }}</p>
                        </div>
                        {% endfor %}
                        
                        <!-- Pagination -->
                        {% if comments.pages > 1 %}
                        <nav aria-label="Comments pagination">
                            <ul class="pagination justify-content-center">
                                {% if comments.has_prev %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('fan.index', page=comments.prev_num) }}">Previous</a>
                                </li>
                                {% endif %}
                                
                                {% for page_num in comments.iter_pages() %}
                                    {% if page_num %}
                                        {% if page_num != comments.page %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ url_for('fan.index', page=page_num) }}">{{ page_num }}</a>
                                        </li>
                                        {% else %}
                                        <li class="page-item active">
                                            <span class="page-link">{{ page_num }}</span>
                                        </li>
                                        {% endif %}
                                    {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if comments.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('fan.index', page=comments.next_num) }}">Next</a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No comments yet</h5>
                            <p class="text-muted">Be the first to share your thoughts with the fan community!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="mb-0">üèÜ League Info</h6>
                </div>
                <div class="card-body">
                    <p class="small text-muted">
                        Welcome to our fan base! This is your space to share opinions, 
                        celebrate victories, discuss matches, and connect with other passionate fans.
                    </p>
                    <hr>
                    <h6>Community Guidelines:</h6>
                    <ul class="small">
                        <li>Be respectful to all fans</li>
                        <li>Keep comments relevant to football</li>
                        <li>No offensive language</li>
                        <li>Support your team passionately!</li>
                    </ul>
                </div>
            </div>

            <div class="card shadow">
                <div class="card-header">
                    <h6 class="mb-0">üìä Quick Stats</h6>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Total Comments:</span>
                        <strong>{{ comments.total }}</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Active Fans:</span>
                        <strong>{{ comments.total }}</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.comment-item:last-child {
    border-bottom: none !important;
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
}

.comment-item:hover {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    transition: background-color 0.2s ease-in-out;
}

.pagination .page-link {
    color: var(--league-primary);
}

.pagination .page-item.active .page-link {
    background-color: var(--league-primary);
    border-color: var(--league-primary);
}

.pagination .page-link:hover {
    color: var(--league-secondary);
}
</style>
{% endblock %}
